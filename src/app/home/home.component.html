<div class="home-container">
  <h2 class="text-center">Product Inventory</h2>

  <div class="filter-selector">
    <label>Search Mode: </label>
    <select [formControl]="filterMethod">
      <option value="all">Show All Products</option>
      <option value="id">Search by ID</option>
      <option value="name">Search by Name</option>
      <option value="advanced">Advanced Filters</option>
      <option *ngIf="isWarehouseManager" value="lowstock">Low Stock</option>
    </select>
  </div>

  <div class="input-panel">
    <div *ngIf="filterType === 'id'">
      <input type="number" min="1" [formControl]="id" placeholder="Enter Product ID" (keydown)="preventNegative($event)">
      <button (click)="searchById()">Find ID</button>
    </div>

    <div *ngIf="filterType === 'name'">
      <input type="text" [formControl]="name" placeholder="Enter Name">
      <button (click)="searchByName()">Search Name</button>
    </div>

    <div *ngIf="filterType === 'advanced'" [formGroup]="advancedForm" class="advanced-grid">
      <input formControlName="name" placeholder="Name">
      <input formControlName="brand" placeholder="Brand">
      <input type="number" min="1" formControlName="finalPrice" placeholder="Max Price" (keydown)="preventNegative($event)">
      <input type="number" min="0" formControlName="discount" placeholder="Min Discount" (keydown)="preventNegative($event)">
      <button (click)="applyAdvancedFilter()">Apply Intersection Filter</button>
    </div>

    <div *ngIf="filterType === 'lowstock'">
      <div [formGroup]="advancedForm" class="advanced-grid">
        <input formControlName="name" placeholder="Name">
        <input formControlName="brand" placeholder="Brand">
        <input type="number" min="1" formControlName="finalPrice" placeholder="Max Price" (keydown)="preventNegative($event)">
        <input type="number" min="0" formControlName="discount" placeholder="Min Discount" (keydown)="preventNegative($event)">
        <button (click)="loadLowStock()">Get Low Stock Products</button>
      </div>
    </div>
  </div>
  
  <div *ngIf="errorMessage" class="alert-box danger">
    {{errorMessage}}
  </div>

  <table class="product-table" *ngIf="products.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Description</th>
        <th>Price</th>
        <th>Discount</th>
        <th>Final Price</th>
        <th>Stock</th>
        @if(isWarehouseManager && filterType === 'lowstock') {
          <th>Min Stock Level</th>
        }
        @if(isWarehouseManager && (filterType === 'lowstock' || filterType === 'id')){
          <th>Status</th>
        }
        @if(isWarehouseManager){
          <th>Manage</th>
        }
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of products">
        <td>{{p.id}}</td>
        <td>{{p.name}}</td>
        <td>{{p.brand}}</td>
        <td>{{p.category}}</td>
        <td>{{p.description}}</td>
        <td>{{p.price}}</td>
        <td>{{p.discount}}%</td>
        <td>{{p.finalPrice}}</td>
        <td>{{p.currentStock}}</td>
        @if(isWarehouseManager && filterType === 'lowstock') {
          <td>{{p.minStockLevel}}</td>
        }
        @if(isWarehouseManager && (filterType === 'lowstock' || filterType === 'id')){
          <td>{{p.isActive?'Active':'Inactive'}}</td>
        }
        @if(isWarehouseManager){
          <td><button [routerLink]="['/manage-product', p.id]">Manage</button></td>
        }
      </tr>
    </tbody>
  </table>
</div>